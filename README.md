# Домашнее задание к занятию «Резервное копирование»

---
## Ахмадеев Булат Наилевич

---

## Задание 1

1. Увидел какие файлы у меня есть:

![ФОТО](<images/Снимок экрана 2024-06-30 в 23.34.42.png>)

2. Проверил что директория ```/tmp/backup/``` существует

![ФОТО](<images/Снимок экрана 2024-06-30 в 23.38.59.png>)

3. Подготавливаю команду ```rsync```:

Команда rsync будет включать несколько опций:

```-a (archive mode)``` — рекурсивная копия с сохранением прав доступа и меток времени.

```--delete``` — удаление файлов в целевой директории, которые отсутствуют в исходной.

```--checksum``` — проверка хэш-сумм для всех файлов.

```--exclude``` — исключение файлов и директорий.

Команда: ```rsync -a --delete --checksum --exclude '/.*' /home/administrator/ /tmp/backup/```

4. Выполнение команды:

Сначала сделал первую копию, а потом сделал несколько манипуляций с файлом ```test.py```.

![ФОТО](<images/Снимок экрана 2024-06-30 в 23.48.51.png>)

---

## Задание 2

1. Создал файл ```/home/administrator/backup.sh```

В нем такой код:
```
#!/bin/bash

# Путь к исходной директории (домашняя директория пользователя)
SOURCE_DIR="/home/administrator/"

# Путь к целевой директории
TARGET_DIR="/tmp/backup/"

# Файл для логирования результатов
LOG_FILE="/var/log/backup.log"

# Выполнение команды rsync
rsync -a --delete --checksum --exclude '/.*' "$SOURCE_DIR" "$TARGET_DIR"

# Проверка успешности выполнения команды rsync
if [ $? -eq 0 ]; then
  echo "$(date '+%Y-%m-%d %H:%M:%S') Выполнено резервное копирование" >> "$LOG_FILE"
else
  echo "$(date '+%Y-%m-%d %H:%M:%S') Ошибка резервного копирования" >> "$LOG_FILE"
fi
```

Объяснение скрипта:

```SOURCE_DIR``` и ```TARGET_DIR``` — это пути к исходной и целевой директориям.

```LOG_FILE``` — это файл, в который будут записываться результаты выполнения.

Команда rsync с необходимыми параметрами создаёт зеркальную копию.

Проверка успешности выполнения команды rsync с помощью ```$?``` — специальной переменной, которая содержит код завершения последней выполненной команды.

В зависимости от результата, в лог-файл добавляется запись об успешном или неуспешном выполнении операции.

2. Сделал скрипт испольняемым командой: ```chmod +x /home/administrator/backup.sh```

3. Открыл редактор crontab и добавил строку ```0 2 * * * /home/administrator/backup.sh```

4. Проверил настройки ```cron```:

![ФОТО](<images/Снимок экрана 2024-07-01 в 00.07.05.png>)

5. Проверяю скрипт вручную:

![ФОТО](<images/Снимок экрана 2024-07-01 в 00.11.20.png>)

Скрипт выполнился без ошибок.

6. Проверка логов:

![ФОТО](<images/Снимок экрана 2024-07-01 в 00.12.10.png>)

---